

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Synthetic Streamflow Diagnostic Figure Library &#8212; Reed group lab manual</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'FigureLibrary/synthetic_generation_diagnostics';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Scatter plots and colorbars using Matplotlib" href="scatterplot_colorbar.html" />
    <link rel="prev" title="Parallel Coordinates Plots" href="ParallelCoordinatesPlots.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to our lab manual!
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../GraduateStudentResources/GraduateStudentResources.html">Graduate Student Resources</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../GraduateStudentResources/LifeAtCornell.html">Housing Around Cornell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GraduateStudentResources/Courses.html">Course List</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GraduateStudentResources/Conferences.html">Conferences</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GraduateStudentResources/PresentationTemplates.html">Presentation Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GraduateStudentResources/WritingProcess.html">Writing your first paper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../GraduateStudentResources/Organization.html">Organizational Tools</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ComputationalResources/ComputationalResources.html">Computational Resources</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ComputationalResources/ClusterBasics.html">Cluster Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ComputationalResources/python_crash_course.html">Crash Course in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ComputationalResources/Machine_Learning_Resources.html">Machine Learning Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ComputationalResources/IntroToLinux.html">Introduction to Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ComputationalResources/IntroToGitHub.html">Introduction to Git &amp; GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ComputationalResources/CitationReferenceManagementTools.html">Citation and Reference Management Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ComputationalResources/Websites.html">Building and deploying websites with Python</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Software/Software.html">Software</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Software/BorgMOEA.html">Borg MOEA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Software/WaterPaths.html">WaterPaths</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Software/PywrDRB.html">Pywr-DRB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Software/CALFEWS.html">CALFEWS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Software/SALib.html">SALib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Software/Rhodium.html">Rhodium</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Software/MOEAFramework.html">MOEA Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Software/J3.html">J3 Visualization</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Training/Training.html">Training</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Training/Schedule.html">Suggested training schedule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Training/Linux_MOEAs_HPC.html">Getting starting with MOEAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Training/LakeProblem.html">The Shallow Lake Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Training/intro_to_sensitivity_analysis.html">Introduction to Sensitivity Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Training/intro_to_scenario_discovery.html">Intro to Scenario Discovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Training/SyntheticStreamflowGeneration.html">Synthetic Streamflow Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Training/StateModTraining.html">Getting Started with StateMod</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Training/MOEADiagnostics.html">Introduction to MOEA Diagnostics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Training/SyntheticWeatherGeneration.html">Synthetic Weather Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Training/FisheriesGame.html">The Fisheries Game</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Training/WaterPaths_Training.html">WaterPaths</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Training/intro_mordm.html">Intro to MORDM</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../WaterProgramming/waterprogramming_post_catalog.html">Water Programming Blog Post Catalog</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="FigureLibrary.html">Figure Library</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ParallelCoordinatesPlots.html">Parallel Coordinates Plots</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Synthetic Streamflow Diagnostic Figure Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="scatterplot_colorbar.html">Scatter plots and colorbars using Matplotlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="scatter3d.html">3D scatter plots, point sizes, and positioning legends</a></li>
<li class="toctree-l2"><a class="reference internal" href="MOEADiagnostics.html">MOEA Diagnostics</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Contributing/Contributing.html">Contributing to this lab manual</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Contributing/Instructions.html">Instructions on contributing to the lab manual</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Contributing/mdExample.html">Markdown example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Contributing/nbExample.html">Jupyter notebook example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Contributing/training_template.html">Training Title</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/reedgroup/reedgroup.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/reedgroup/reedgroup.github.io/issues/new?title=Issue%20on%20page%20%2FFigureLibrary/synthetic_generation_diagnostics.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/FigureLibrary/synthetic_generation_diagnostics.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Synthetic Streamflow Diagnostic Figure Library</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#diagnostic-plotting-functions">Diagnostic plotting functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#streamflow-data">Streamflow data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#flow-magnitude-range">Flow magnitude range</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#flow-duration-curve-ranges">Flow duration curve ranges</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelation">Autocorrelation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-correlation">Spatial Correlation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="synthetic-streamflow-diagnostic-figure-library">
<h1>Synthetic Streamflow Diagnostic Figure Library<a class="headerlink" href="#synthetic-streamflow-diagnostic-figure-library" title="Permalink to this heading">#</a></h1>
<p>The following functions can be used to compare the following properties of historic and synthetic streamflow:</p>
<ul class="simple">
<li><p>Flow magnitude</p></li>
<li><p>Non-exceedance probabilities (flow duration curves)</p></li>
<li><p>Autocorrelation</p></li>
<li><p>Spatial correlation across locations</p></li>
</ul>
<section id="diagnostic-plotting-functions">
<h2>Diagnostic plotting functions<a class="headerlink" href="#diagnostic-plotting-functions" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">plot_flow_ranges()</span></code></p>
<ul>
<li><p>Range and median of flow values in historic and synthetic flow timeseries.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">plot_fdc_ranges()</span></code></p>
<ul>
<li><p>The range of annual flow duration curves (FDCs) for historic and synthetic streamflow timeseries.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">plot_autocorrelation()</span></code></p>
<ul>
<li><p>Comparison of historic and synthetic autocorrelation across a range of lag values.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">plot_spatial_correlation()</span></code></p>
<ul>
<li><p>Heatmap visualizations of Pearson correlation between different flow locations in the historic data and a single synthetic realization.</p></li>
</ul>
</li>
</ul>
<p>These functions are designed to accept historic (<code class="docutils literal notranslate"><span class="pre">Qh</span></code>) and synthetic (<code class="docutils literal notranslate"><span class="pre">Qs</span></code>) data with the following properties:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Qh</span></code> : A pd.Series containing a single historic streamflow timeseries. The index of this data must be type pd.DatetimeIndex.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Qs</span></code> : A pd.DataFrame containing many synthetic streamflow timeseries. The columns should each contain a single synthetic realization and the index must be type pd.DatetimeIndex. The column names do not matter.</p></li>
</ul>
<p>Additionally, each function (excluding <code class="docutils literal notranslate"><span class="pre">plot_fdc_ranges()</span></code>) has a <code class="docutils literal notranslate"><span class="pre">timestep</span></code> keyword argument which changes the temporal scale of the flow being considered. Options are ‘daily’, ‘weekly’, or ‘monthly’, and the <code class="docutils literal notranslate"><span class="pre">pandas.groupby()</span></code> function is used to aggregate data accordingly to allow for comparison of statistics at different temporal scales. The default is ‘daily’.</p>
</section>
<section id="streamflow-data">
<h2>Streamflow data<a class="headerlink" href="#streamflow-data" title="Permalink to this heading">#</a></h2>
<p>The historic data used in this example is taken from the Delaware River Basin. Specifically, streamflow data from the <a class="reference external" href="https://waterdata.usgs.gov/monitoring-location/01427207/#parameterCode=00065&amp;period=P7D">USGS gauge at Lordville, NY,</a> on the upper portion of the Delaware River is used.</p>
<p>The synthetic streamflow was generated using the Kirsch-Nowak [2, 3] synthetic streamflow generator. For more detail on this generator, see Julie’s post here: <a class="reference external" href="https://waterprogramming.wordpress.com/2017/08/29/open-source-streamflow-generator-part-i-synthetic-generation/">Open Source Streamflow Generator Part 1.</a></p>
<p>I created 100 synthetic realizations of 30-year, daily streamflow timeseries at the Lordville gauge.</p>
<p>The historic and synthetic streamflow timeseries are assumed to start at the same date. Most of the plotting functions below do not explicitly consider the date associated with the timeseries, however comparisons between flow statistics across some range of time assume that the timeseries are aligned for the same dates.</p>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span>

<span class="c1"># Load and prepare the data</span>
<span class="n">Qs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./example_data/synthetic_streamflow_100_realizations_delLordville.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">Qh_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./example_data/gage_flow_obs_pub.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;1984-01-01&#39;</span><span class="p">:,</span> <span class="p">:]</span>
<span class="n">Qh</span> <span class="o">=</span> <span class="n">Qh_df</span><span class="p">[</span><span class="s1">&#39;delLordville&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="flow-magnitude-range">
<h2>Flow magnitude range<a class="headerlink" href="#flow-magnitude-range" title="Permalink to this heading">#</a></h2>
<p>This first plot simply shows the range (max, min) and median of flows for both historic and synthetic datasets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_flow_ranges</span><span class="p">(</span><span class="n">Qh</span><span class="p">,</span> <span class="n">Qs</span><span class="p">,</span> 
                     <span class="n">timestep</span> <span class="o">=</span> <span class="s1">&#39;daily&#39;</span><span class="p">,</span>
                     <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;cms&#39;</span><span class="p">,</span> <span class="n">y_scale</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span>
                     <span class="n">savefig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fig_dir</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
                     <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">],</span>
                     <span class="n">title_addon</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plots the range of flow for historic and syntehtic streamflows for a specific timestep scale.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        Qh (pd.Series): Historic daily streamflow timeseries. Index must be pd.DatetimeIndex. </span>
<span class="sd">        Qs (pd.DataFrame): Synthetic daily streamflow timeseries realizations. Each column is a unique realization. Index must be pd.DatetimeIndex.</span>
<span class="sd">        timestep (str, optional): The timestep which data should be aggregated over. Defaults to &#39;daily&#39;. Options are &#39;daily&#39;, &#39;weekly&#39;, or &#39;monthly&#39;.</span>
<span class="sd">        units (str, optional): Streamflow units, for axis label. Defaults to &#39;cms&#39;.</span>
<span class="sd">        y_scale (str, optional): Scale of the y-axis. Defaults to &#39;log&#39;.</span>
<span class="sd">        savefig (bool, optional): Allows for png to be saved to fig_dir. Defaults to False.</span>
<span class="sd">        fig_dir (str, optional): Location of saved figure output. Defaults to &#39;.&#39; (working directory).</span>
<span class="sd">        figsize (tuple, optional): The figure size. Defaults to (4,4).</span>
<span class="sd">        colors (list, optional): List of two colors for historic and synthetic data respectively. Defaults to [&#39;black&#39;, &#39;orange&#39;].</span>
<span class="sd">        title_addon (str, optional): Text to be added to the end of the title. Defaults to &quot;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="c1"># Assert formatting matches expected</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Qh</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">),</span> <span class="s1">&#39;Historic streamflow (Qh) should have pd.DatatimeIndex.&#39;</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Qs</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">),</span> <span class="s1">&#39;Synthetic streamflow (Qh) should have pd.DatatimeIndex.&#39;</span>

    <span class="c1"># Handle conditional datetime formatting</span>
    <span class="k">if</span> <span class="n">timestep</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>
        <span class="n">h_grouper</span> <span class="o">=</span> <span class="n">Qh</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dayofyear</span>
        <span class="n">s_grouper</span> <span class="o">=</span> <span class="n">Qs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dayofyear</span>
        <span class="n">x_lab</span> <span class="o">=</span> <span class="s1">&#39;Day of the Year (Jan-Dec)&#39;</span>
    <span class="k">elif</span> <span class="n">timestep</span> <span class="o">==</span> <span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
        <span class="n">h_grouper</span> <span class="o">=</span> <span class="n">Qh</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span>
        <span class="n">s_grouper</span> <span class="o">=</span> <span class="n">Qs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span>
        <span class="n">x_lab</span> <span class="o">=</span> <span class="s1">&#39;Month of the Year (Jan-Dec)&#39;</span>
    <span class="k">elif</span> <span class="n">timestep</span> <span class="o">==</span> <span class="s1">&#39;weekly&#39;</span><span class="p">:</span>
        <span class="n">h_grouper</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">Qh</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()</span><span class="o">.</span><span class="n">week</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
        <span class="n">s_grouper</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">Qs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()</span><span class="o">.</span><span class="n">week</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span><span class="p">)</span>
        <span class="n">x_lab</span> <span class="o">=</span> <span class="s1">&#39;Week of the Year (Jan-Dec)&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Invalid timestep input. Options: &quot;daily&quot;, &quot;monthly&quot;, &quot;weekly&quot;.&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Find flow ranges</span>
    <span class="n">s_max</span> <span class="o">=</span> <span class="n">Qs</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">s_grouper</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s_min</span> <span class="o">=</span> <span class="n">Qs</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">s_grouper</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s_median</span> <span class="o">=</span> <span class="n">Qs</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">s_grouper</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">h_max</span> <span class="o">=</span> <span class="n">Qh</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">h_grouper</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">h_min</span> <span class="o">=</span> <span class="n">Qh</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">h_grouper</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">h_median</span> <span class="o">=</span> <span class="n">Qh</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">h_grouper</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
  
    <span class="c1">## Plotting  </span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">h_max</span><span class="o">.</span><span class="n">index</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">s_min</span><span class="p">,</span> <span class="n">s_max</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Synthetic Range&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">s_median</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Synthetic Median&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">h_min</span><span class="p">,</span> <span class="n">h_max</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Historic Range&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">h_median</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Historic Median&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">y_scale</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">timestep</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> Flow (</span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_lab</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper center&#39;</span><span class="p">)</span>    
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">timestep</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> Streamflow Ranges</span><span class="se">\n</span><span class="s1">Historic &amp; Synthetic Timeseries at One Location</span><span class="se">\n</span><span class="si">{</span><span class="n">title_addon</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">savefig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fig_dir</span><span class="si">}</span><span class="s1">/flow_ranges_</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">150</span><span class="p">)</span>
    <span class="k">return</span>

<span class="c1">## Usage</span>
<span class="n">plot_flow_ranges</span><span class="p">(</span><span class="n">Qh</span><span class="p">,</span> <span class="n">Qs</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="s1">&#39;daily&#39;</span><span class="p">,</span> <span class="n">savefig</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/78757962ad4b536b081cb9e47e6aa3f3242f6c250ceea6736e40a9269b7fc602.png" src="../_images/78757962ad4b536b081cb9e47e6aa3f3242f6c250ceea6736e40a9269b7fc602.png" />
</div>
</div>
<p>This figure provides a lot of useful information about our synthetic ensemble:</p>
<ul class="simple">
<li><p>The synthetic ensembles envelope the limited historic values, and include more extreme high and low flows</p></li>
<li><p>The seasonal trends in the synthetics align with the historic</p></li>
<li><p>The median of the synthetic ensemble aligns very closely with the median of the historic data.</p></li>
</ul>
<section id="flow-duration-curve-ranges">
<h3>Flow duration curve ranges<a class="headerlink" href="#flow-duration-curve-ranges" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">plot_fdc_ranges()</span></code> function will calculate an FDC for each year of the historic and synthetic data, and plot the ranges that these FDCs take. It will also “total” FDCs calculated for the entirety of the historic or synthetic records.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_fdc_ranges</span><span class="p">(</span><span class="n">Qh</span><span class="p">,</span> <span class="n">Qs</span><span class="p">,</span> 
                    <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;cms&#39;</span><span class="p">,</span> <span class="n">y_scale</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span>
                    <span class="n">savefig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fig_dir</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
                    <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">],</span>                   
                    <span class="n">title_addon</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plots the range and aggregate flow duration curves for historic and synthetic streamflows.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        Qh (pd.Series): Historic daily streamflow timeseries. Index must be pd.DatetimeIndex. </span>
<span class="sd">        Qs (pd.DataFrame): Synthetic daily streamflow timeseries realizations. Each column is a unique realization. Index must be pd.DatetimeIndex.</span>
<span class="sd">        units (str, optional): Streamflow units, for axis label. Defaults to &#39;cms&#39;.</span>
<span class="sd">        y_scale (str, optional): Scale of the y-axis. Defaults to &#39;log&#39;.</span>
<span class="sd">        savefig (bool, optional): Allows for png to be saved to fig_dir. Defaults to False.</span>
<span class="sd">        fig_dir (str, optional): Location of saved figure output. Defaults to &#39;.&#39; (working directory).</span>
<span class="sd">        figsize (tuple, optional): The figure size. Defaults to (4,4).</span>
<span class="sd">        colors (list, optional): List of two colors for historic and synthetic data respectively. Defaults to [&#39;black&#39;, &#39;orange&#39;].</span>
<span class="sd">        title_addon (str, optional): Text to be added to the end of the title. Defaults to &quot;&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">## Assertions</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Qs</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">),</span> <span class="s1">&#39;Synthetic streamflow should be type pd.DataFrame.&#39;</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Qh</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">),</span> <span class="s1">&#39;Historic streamflow (Qh) should have pd.DatatimeIndex.&#39;</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Qs</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">),</span> <span class="s1">&#39;Synthetic streamflow (Qh) should have pd.DatatimeIndex.&#39;</span>

    
    <span class="c1"># Calculate FDCs for total period and each realization</span>
    <span class="n">nonexceedance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.9999</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">s_total_fdc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">Qs</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">nonexceedance</span><span class="p">)</span>
    <span class="n">h_total_fdc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">Qh</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">nonexceedance</span><span class="p">)</span> 
    
    <span class="n">s_fdc_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">nonexceedance</span><span class="p">)</span>
    <span class="n">s_fdc_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">nonexceedance</span><span class="p">)</span>
    <span class="n">h_fdc_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">nonexceedance</span><span class="p">)</span>
    <span class="n">h_fdc_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">nonexceedance</span><span class="p">)</span>

    <span class="n">annual_synthetics</span> <span class="o">=</span> <span class="n">Qs</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">Qs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
    <span class="n">annual_historic</span> <span class="o">=</span> <span class="n">Qh</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">Qh</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nonexceedance</span><span class="p">):</span>
            <span class="n">s_fdc_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_synthetics</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">quant</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">s_fdc_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_synthetics</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">quant</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">h_fdc_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_historic</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">quant</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">h_fdc_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_historic</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">quant</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    
    <span class="c1">## Plotting</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    
    <span class="c1">#for quant in syn_fdc_quants:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">nonexceedance</span><span class="p">,</span> <span class="n">s_fdc_min</span><span class="p">,</span> <span class="n">s_fdc_max</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Synthetic Annual FDC Range&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">nonexceedance</span><span class="p">,</span> <span class="n">h_fdc_min</span><span class="p">,</span> <span class="n">h_fdc_max</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Historic Annual FDC Range&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nonexceedance</span><span class="p">,</span> <span class="n">s_total_fdc</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Synthetic Total FDC&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nonexceedance</span><span class="p">,</span> <span class="n">h_total_fdc</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Historic Total FDC&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">y_scale</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Flow (</span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Non-Exceedance Probability&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Flow Duration Curve Ranges</span><span class="se">\n</span><span class="s1">Historic &amp; Synthetic Streamflow</span><span class="se">\n</span><span class="si">{</span><span class="n">title_addon</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">savefig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fig_dir</span><span class="si">}</span><span class="s1">/flow_duration_curves_</span><span class="si">{</span><span class="n">title_addon</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>

<span class="c1">## Usage</span>
<span class="n">plot_fdc_ranges</span><span class="p">(</span><span class="n">Qh</span><span class="p">,</span> <span class="n">Qs</span><span class="p">,</span> <span class="n">savefig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">line</span> <span class="mi">69</span>
<span class="g g-Whitespace">     </span><span class="mi">66</span>     <span class="k">return</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span> <span class="c1">## Usage</span>
<span class="ne">---&gt; </span><span class="mi">69</span> <span class="n">plot_fdc_ranges</span><span class="p">(</span><span class="n">Qh</span><span class="p">,</span> <span class="n">Qs</span><span class="p">,</span> <span class="n">savefig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="nn">Cell In[3], line 40,</span> in <span class="ni">plot_fdc_ranges</span><span class="nt">(Qh, Qs, units, y_scale, savefig, fig_dir, figsize, colors, title_addon)</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span> <span class="n">annual_historic</span> <span class="o">=</span> <span class="n">Qh</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">Qh</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">quant</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nonexceedance</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">40</span>         <span class="n">s_fdc_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_synthetics</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">quant</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>         <span class="n">s_fdc_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_synthetics</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">quant</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span>         <span class="n">h_fdc_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">annual_historic</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">quant</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="nn">File ~/.virtualenvs/.venv/lib/python3.8/site-packages/pandas/core/groupby/groupby.py:3303,</span> in <span class="ni">GroupBy.quantile</span><span class="nt">(self, q, interpolation, numeric_only)</span>
<span class="g g-Whitespace">   </span><span class="mi">3300</span>     <span class="k">return</span> <span class="n">post_processor</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">inference</span><span class="p">,</span> <span class="n">result_mask</span><span class="p">,</span> <span class="n">orig_vals</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3302</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_to_aggregate</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="n">numeric_only</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;quantile&quot;</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">3303</span> <span class="n">res_mgr</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">grouped_reduce</span><span class="p">(</span><span class="n">blk_func</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3305</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrap_agged_manager</span><span class="p">(</span><span class="n">res_mgr</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3307</span> <span class="k">if</span> <span class="n">orig_scalar</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3308</span>     <span class="c1"># Avoid expensive MultiIndex construction</span>

<span class="nn">File ~/.virtualenvs/.venv/lib/python3.8/site-packages/pandas/core/internals/managers.py:1506,</span> in <span class="ni">BlockManager.grouped_reduce</span><span class="nt">(self, func)</span>
<span class="g g-Whitespace">   </span><span class="mi">1504</span>             <span class="n">result_blocks</span> <span class="o">=</span> <span class="n">extend_blocks</span><span class="p">(</span><span class="n">applied</span><span class="p">,</span> <span class="n">result_blocks</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1505</span>     <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1506</span>         <span class="n">applied</span> <span class="o">=</span> <span class="n">blk</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1507</span>         <span class="n">result_blocks</span> <span class="o">=</span> <span class="n">extend_blocks</span><span class="p">(</span><span class="n">applied</span><span class="p">,</span> <span class="n">result_blocks</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1509</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_blocks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

<span class="nn">File ~/.virtualenvs/.venv/lib/python3.8/site-packages/pandas/core/internals/blocks.py:329,</span> in <span class="ni">Block.apply</span><span class="nt">(self, func, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">323</span> <span class="nd">@final</span>
<span class="g g-Whitespace">    </span><span class="mi">324</span> <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Block</span><span class="p">]:</span>
<span class="g g-Whitespace">    </span><span class="mi">325</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">326</span><span class="sd">     apply the function to my values; return a block if we are not</span>
<span class="g g-Whitespace">    </span><span class="mi">327</span><span class="sd">     one</span>
<span class="g g-Whitespace">    </span><span class="mi">328</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">329</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">331</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_op_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="nn">File ~/.virtualenvs/.venv/lib/python3.8/site-packages/pandas/core/groupby/groupby.py:3274,</span> in <span class="ni">GroupBy.quantile.&lt;locals&gt;.blk_func</span><span class="nt">(values)</span>
<span class="g g-Whitespace">   </span><span class="mi">3272</span> <span class="c1"># Get an index of values sorted by values and then labels</span>
<span class="g g-Whitespace">   </span><span class="mi">3273</span> <span class="n">order</span> <span class="o">=</span> <span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">shaped_labels</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">3274</span> <span class="n">sort_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">(</span><span class="n">order</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intp</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3276</span> <span class="k">if</span> <span class="n">is_datetimelike</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3277</span>     <span class="c1"># This casting needs to happen after the lexsort in order</span>
<span class="g g-Whitespace">   </span><span class="mi">3278</span>     <span class="c1">#  to ensure that NaTs are placed at the end and not the front</span>
<span class="g g-Whitespace">   </span><span class="mi">3279</span>     <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s2">&quot;i8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="nn">File &lt;__array_function__ internals&gt;:200,</span> in <span class="ni">lexsort</span><span class="nt">(*args, **kwargs)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<p>Similar to the flow range plot above, we see that the synthetic ensemble is nicely enveloping the historic data; there are synthetic instances where the extreme flows in a particular year are more extreme than historic observations. However, the FDC of the total synthetic ensemble (if all synthetics were combined) is almost exactly equal to the total historic FDC.</p>
</section>
</section>
<section id="autocorrelation">
<h2>Autocorrelation<a class="headerlink" href="#autocorrelation" title="Permalink to this heading">#</a></h2>
<p>Hydrologic systems are known to have memory, or correlation between streamflow at different points in time. We want to make sure that our synthetic streamflow timeseries have similar memory or autocorrelation.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">plot_autocorrelation()</span></code> function will calculate autocorrelation for the historic record, and each synthetic realization for a range of different lag values. In addition to the required <code class="docutils literal notranslate"><span class="pre">Qh</span></code> and <code class="docutils literal notranslate"><span class="pre">Qs</span></code> arguments this function requires <code class="docutils literal notranslate"><span class="pre">lag_range</span></code> which should be a list or array of lag values to be considered.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_autocorrelation</span><span class="p">(</span><span class="n">Qh</span><span class="p">,</span> <span class="n">Qs</span><span class="p">,</span> <span class="n">lag_range</span><span class="p">,</span> 
                         <span class="n">timestep</span> <span class="o">=</span> <span class="s1">&#39;daily&#39;</span><span class="p">,</span>
                         <span class="n">savefig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fig_dir</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
                         <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">],</span>
                         <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot autocorrelation of historic and synthetic flow over some range of lags.</span>

<span class="sd">    Args:</span>
<span class="sd">        Qh (pd.Series): Historic daily streamflow timeseries. Index must be pd.DatetimeIndex. </span>
<span class="sd">        Qs (pd.DataFrame): Synthetic daily streamflow timeseries realizations. Each column is a unique realization. Index must be pd.DatetimeIndex.</span>
<span class="sd">        lag_range (iterable): A list or range of lag values to be used for autocorrelation calculation.</span>
<span class="sd">        </span>
<span class="sd">        timestep (str, optional): The timestep which data should be aggregated over. Defaults to &#39;daily&#39;. Options are &#39;daily&#39;, &#39;weekly&#39;, or &#39;monthly&#39;.</span>
<span class="sd">        savefig (bool, optional): Allows for png to be saved to fig_dir. Defaults to False.</span>
<span class="sd">        fig_dir (str, optional): Location of saved figure output. Defaults to &#39;.&#39; (working directory).</span>
<span class="sd">        figsize (tuple, optional): The figure size. Defaults to (4,4).</span>
<span class="sd">        colors (list, optional): List of two colors for historic and synthetic data respectively. Defaults to [&#39;black&#39;, &#39;orange&#39;].</span>
<span class="sd">        alpha (float, optional): The opacity of synthetic data. Defaults to 0.3.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">## Assertions</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Qs</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">),</span> <span class="s1">&#39;Synthetic streamflow should be type pd.DataFrame.&#39;</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Qh</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">),</span> <span class="s1">&#39;Historic streamflow (Qh) should have pd.DatatimeIndex.&#39;</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Qs</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">),</span> <span class="s1">&#39;Synthetic streamflow (Qh) should have pd.DatatimeIndex.&#39;</span>

    <span class="k">if</span> <span class="n">timestep</span> <span class="o">==</span> <span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
        <span class="n">Qh</span> <span class="o">=</span> <span class="n">Qh</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;MS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">Qs</span> <span class="o">=</span> <span class="n">Qs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;MS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">time_label</span> <span class="o">=</span> <span class="s1">&#39;months&#39;</span>
    <span class="k">elif</span> <span class="n">timestep</span> <span class="o">==</span> <span class="s1">&#39;weekly&#39;</span><span class="p">:</span>
        <span class="n">Qh</span> <span class="o">=</span> <span class="n">Qh</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W-SUN&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">Qs</span> <span class="o">=</span> <span class="n">Qs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W-SUN&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">time_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;weeks&#39;</span>
    <span class="k">elif</span> <span class="n">timestep</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>
        <span class="n">time_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;days&#39;</span>
        
    <span class="c1"># Calculate autocorrelations</span>
    <span class="n">autocorr_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lag_range</span><span class="p">))</span>
    <span class="n">confidence_autocorr_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lag_range</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lag_range</span><span class="p">):</span>
        <span class="n">h_corr</span> <span class="o">=</span> <span class="n">pearsonr</span><span class="p">(</span><span class="n">Qh</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="n">lag</span><span class="p">],</span> <span class="n">Qh</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">lag</span><span class="p">:])</span>
        <span class="n">autocorr_h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">h_corr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">confidence_autocorr_h</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">h_corr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">h_corr</span><span class="o">.</span><span class="n">confidence_interval</span><span class="p">()</span><span class="o">.</span><span class="n">low</span>
        <span class="n">confidence_autocorr_h</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">h_corr</span><span class="o">.</span><span class="n">confidence_interval</span><span class="p">()</span><span class="o">.</span><span class="n">high</span> <span class="o">-</span> <span class="n">h_corr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="n">autocorr_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Qs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">lag_range</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">realization</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Qs</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="n">autocorr_s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">Qs</span><span class="p">[</span><span class="n">realization</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="n">lag</span><span class="p">],</span> <span class="n">Qs</span><span class="p">[</span><span class="n">realization</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">lag</span><span class="p">:])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">lag_range</span><span class="p">]</span>


    <span class="c1">## Plotting</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

    <span class="c1"># Plot autocorrelation for each synthetic timeseries</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">realization</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Qs</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lag_range</span><span class="p">,</span> <span class="n">autocorr_s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Synthetic Realization&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lag_range</span><span class="p">,</span> <span class="n">autocorr_s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lag_range</span><span class="p">,</span> <span class="n">autocorr_s</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Plot autocorrelation for the historic timeseries</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lag_range</span><span class="p">,</span> <span class="n">autocorr_h</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Historic&#39;</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">lag_range</span><span class="p">,</span> <span class="n">autocorr_h</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">lag_range</span><span class="p">,</span> <span class="n">autocorr_h</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">confidence_autocorr_h</span><span class="p">,</span> 
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span><span class="s1">&#39;Historic 95% CI&#39;</span><span class="p">)</span>

    <span class="c1"># Set labels and title</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lag (</span><span class="si">{</span><span class="n">time_label</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Autocorrelation (Pearson)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Autocorrelation Comparison</span><span class="se">\n</span><span class="s1">Historic Timeseries vs. Synthetic Ensemble&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.92</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">savefig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fig_dir</span><span class="si">}</span><span class="s1">/autocorrelation_plot_</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>

<span class="c1">## Usage</span>
<span class="n">plot_autocorrelation</span><span class="p">(</span><span class="n">Qh</span><span class="p">,</span> <span class="n">Qs</span><span class="p">,</span> <span class="n">lag_range</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">timestep</span><span class="o">=</span><span class="s1">&#39;daily&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9a192bed80275df004736133bb4f676820a4e71f2d7707a1667b8147ff1afb15.png" src="../_images/9a192bed80275df004736133bb4f676820a4e71f2d7707a1667b8147ff1afb15.png" />
</div>
</div>
</section>
<section id="spatial-correlation">
<h2>Spatial Correlation<a class="headerlink" href="#spatial-correlation" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">plot_spatial_correlation()</span></code> function generates a heatmap visualization of the Pearson correlation matrix for streamflow at different locations in both the historic and synthetic datasets.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">plot_spatial_correlation()</span></code> function is different from the other three functions shown above, since it requires a set of timeseries data for multiple different locations.</p>
<p>Rather than providing a set of many different realizations for a single site we need to provide a single realization of synthetics across all sites of interest, with a timeseries for each site in each column. This new input is <code class="docutils literal notranslate"><span class="pre">Qs_i</span></code>, and must the same columns as <code class="docutils literal notranslate"><span class="pre">Qh</span></code> (they both must contain a timeseries for each location).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_correlation</span><span class="p">(</span><span class="n">Qh</span><span class="p">,</span> <span class="n">Qs_i</span><span class="p">,</span>
                        <span class="n">timestep</span> <span class="o">=</span> <span class="s1">&#39;daily&#39;</span><span class="p">,</span>
                        <span class="n">savefig</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fig_dir</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
                        <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">color_map</span> <span class="o">=</span> <span class="s1">&#39;BuPu&#39;</span><span class="p">,</span>
                        <span class="n">cbar_on</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plots the side-by-side heatmaps of flow correlation between sites for historic and synthetic multi-site data.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        Qh (pd.DataFrame): Historic daily streamflow timeseries at many different locations. The columns of Qh and Qs_i must match, and index must be pd.DatetimeIndex. </span>
<span class="sd">        Qs (pd.DataFrame): Synthetic daily streamflow timeseries realizations. Each column is a unique realization. The columns of Qh and Qs_i must match, and index must be pd.DatetimeIndex.</span>
<span class="sd">        timestep (str, optional): The timestep which data should be aggregated over. Defaults to &#39;daily&#39;. Options are &#39;daily&#39;, &#39;weekly&#39;, or &#39;monthly&#39;.</span>
<span class="sd">        savefig (bool, optional): Allows for png to be saved to fig_dir. Defaults to False.</span>
<span class="sd">        fig_dir (str, optional): Location of saved figure output. Defaults to &#39;.&#39; (working directory).</span>
<span class="sd">        figsize (tuple, optional): The figure size. Defaults to (4,4).</span>
<span class="sd">        color_map (str, optional): The colormap used for the heatmaps. Defaults to &#39;BuPu.</span>
<span class="sd">        cbar_on (bool, optional): Indictor if the colorbar should be shown or not. Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">## Assertions</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Qh</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">Qs_i</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Qh</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)),</span> <span class="s1">&#39;Both inputs Qh and Qs_i should be pd.DataFrames.&#39;</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">Qh</span><span class="o">.</span><span class="n">columns</span> <span class="o">==</span> <span class="n">Qs_i</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">),</span> <span class="s1">&#39;Historic and synthetic data should have same columns.&#39;</span>
    
    <span class="k">if</span> <span class="n">timestep</span> <span class="o">==</span> <span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
        <span class="n">Qh</span> <span class="o">=</span> <span class="n">Qh</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;MS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">Qs_i</span> <span class="o">=</span> <span class="n">Qs_i</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;MS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">timestep</span> <span class="o">==</span> <span class="s1">&#39;weekly&#39;</span><span class="p">:</span>
        <span class="n">Qh</span> <span class="o">=</span> <span class="n">Qh</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W-SUN&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">Qs_i</span> <span class="o">=</span> <span class="n">Qs_i</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;W-SUN&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    
    <span class="c1">## Plotting</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">250</span><span class="p">)</span>
    
    <span class="c1"># Heatmap of historic correlation</span>
    <span class="n">h_correlation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">Qh</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">h_correlation</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> 
                <span class="n">square</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">xticklabels</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">yticklabels</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
                <span class="n">cmap</span> <span class="o">=</span> <span class="n">color_map</span><span class="p">,</span> <span class="n">cbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Synthetic correlation</span>
    <span class="n">s_correlation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">Qs_i</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">s_correlation</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">,</span>
                <span class="n">square</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">xticklabels</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">yticklabels</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> 
                <span class="n">cmap</span> <span class="o">=</span> <span class="n">color_map</span><span class="p">,</span> <span class="n">cbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">axi</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">):</span>
        <span class="n">axi</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="n">axi</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Site i&#39;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Site j&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Historic Streamflow&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Site i&#39;</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Site j&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Synthetic Realization&#39;</span><span class="p">)</span>
    <span class="n">title_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Pearson correlation across different streamflow locations</span><span class="se">\n</span><span class="si">{</span><span class="n">timestep</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> timescale</span><span class="se">\n</span><span class="s1">&#39;</span>
        
    <span class="c1"># Adjust the layout to make room for the colorbar</span>
    <span class="k">if</span> <span class="n">cbar_on</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">])</span>
        <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>  <span class="c1"># [left, bottom, width, height]</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Pearson Correlation&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title_string</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">savefig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fig_dir</span><span class="si">}</span><span class="s1">/spatial_correlation_comparison_</span><span class="si">{</span><span class="n">timestep</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">,</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">250</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<p>To use this function, I need to load a different <code class="docutils literal notranslate"><span class="pre">pd.DataFrame</span></code> containing synthetic timeseries at all of my study locations. I will also load the full set of historic streamflows at all locations (<code class="docutils literal notranslate"><span class="pre">Qh_df</span></code>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Usage</span>
<span class="n">single_synthetic_all_sites</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./example_data/synthetic_streamflow_single_realization_all_sites.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Qh_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;./example_data/gage_flow_obs_pub.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;1984-01-01&#39;</span><span class="p">:,</span> <span class="p">:]</span>
 
<span class="n">plot_correlation</span><span class="p">(</span><span class="n">Qh_df</span><span class="p">,</span> <span class="n">single_synthetic_all_sites</span><span class="p">,</span> <span class="n">timestep</span><span class="o">=</span><span class="s1">&#39;weekly&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/eb8c399aed255bb817699e425f9d2f98893cd216aad15c6a2edebf9d666a4516.png" src="../_images/eb8c399aed255bb817699e425f9d2f98893cd216aad15c6a2edebf9d666a4516.png" />
</div>
</div>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<p>[1] Kirsch, B. R., Characklis, G. W., &amp; Zeff, H. B. (2013). Evaluating the impact of alternative hydro-climate scenarios on transfer agreements: Practical improvement for generating synthetic streamflows. Journal of Water Resources Planning and Management, 139(4), 396-406.</p>
<p>[2] Nowak, K., Prairie, J., Rajagopalan, B., &amp; Lall, U. (2010). A nonparametric stochastic approach for multisite disaggregation of annual to daily streamflow. Water Resources Research, 46(8).</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: ".venv"
        },
        kernelOptions: {
            name: ".venv",
            path: "./FigureLibrary"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = '.venv'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="ParallelCoordinatesPlots.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Parallel Coordinates Plots</p>
      </div>
    </a>
    <a class="right-next"
       href="scatterplot_colorbar.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Scatter plots and colorbars using Matplotlib</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#diagnostic-plotting-functions">Diagnostic plotting functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#streamflow-data">Streamflow data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#flow-magnitude-range">Flow magnitude range</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#flow-duration-curve-ranges">Flow duration curve ranges</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autocorrelation">Autocorrelation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-correlation">Spatial Correlation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Reed Group at Cornell CEE
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>